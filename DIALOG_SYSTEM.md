# 对话框系统实现完成

## 新增功能

### 1. 对话框系统 (`src/ui/dialogs.rs`)

实现了三种对话框类型：

#### 输入对话框 (Input Dialog)
- 用于输入文本（项目名、任务标题等）
- 支持光标移动和编辑
- 快捷键：
  - `Enter` - 确认
  - `ESC` - 取消
  - `←/→` - 移动光标
  - `Home/End` - 跳转到开头/结尾
  - `Backspace/Delete` - 删除字符

#### 选择对话框 (Select Dialog)
- 用于从列表中选择项目
- 支持实时搜索过滤
- 快捷键：
  - `j/k` 或 `↑/↓` - 上下选择
  - `Enter` - 确认选择
  - `ESC` - 取消
  - 输入任意字符 - 过滤列表
  - `Backspace` - 删除过滤字符

#### 确认对话框 (Confirm Dialog)
- 用于确认危险操作（删除等）
- 快捷键：
  - `h/l` 或 `←/→` - 切换是/否
  - `y` - 直接确认
  - `n` 或 `ESC` - 取消
  - `Enter` - 确认当前选择

### 2. 集成到应用状态

#### 新增 Dialog 模式
- `Mode::Dialog` - 专门处理对话框输入
- 在状态栏显示为 "DIALOG"（紫色）

#### 应用状态变更
- 添加 `dialog: Option<DialogType>` 字段
- 当对话框打开时，模式自动切换为 `Mode::Dialog`
- 对话框关闭后，自动返回 `Mode::Normal`

### 3. 键盘命令集成

#### 项目管理命令
- `Space p n` - 创建新项目
  - 打开输入对话框
  - 输入项目名称后自动创建
  - 创建成功后在当前面板打开新项目

- `Space p o` - 打开项目
  - 打开选择对话框
  - 显示所有现有项目
  - 支持搜索过滤
  - 选择后在当前面板打开

#### 任务操作命令（已添加入口）
- `a` - 创建新任务（打开输入对话框）
- `e` - 编辑任务
- `d` - 删除任务

### 4. UI 渲染更新

- 对话框在主界面上方居中显示
- 使用 `Clear` widget 清空对话框区域背景
- 对话框使用半透明效果（通过清空背景实现）
- 保持底部界面可见但聚焦在对话框

## 文件结构

```
src/
├── ui/
│   ├── dialogs.rs       # 新增：对话框渲染和类型定义
│   ├── mod.rs           # 修改：添加对话框渲染
│   ├── statusbar.rs     # 修改：添加 Dialog 模式显示
│   └── ...
├── input/
│   └── keyboard.rs      # 修改：添加对话框处理逻辑
└── app.rs               # 修改：添加对话框状态
```

## 使用示例

### 创建新项目
1. 按 `Space`，状态栏显示 `[ ]`
2. 按 `p`，状态栏显示 `[ p]`
3. 按 `n`，弹出"创建新项目"对话框
4. 输入项目名称，如 "my-project"
5. 按 `Enter` 确认
6. 项目创建完成，自动在当前面板打开

### 打开现有项目
1. 按 `Space p o`
2. 弹出项目选择对话框
3. 使用 `j/k` 浏览项目列表
4. 可以输入字符进行搜索过滤
5. 按 `Enter` 选择项目
6. 项目在当前面板打开

## 对话框样式

- 标题栏：青色边框
- 输入框：黄色边框，显示光标
- 选中项：深灰背景，粗体
- 帮助文本：深灰色，居中显示
- 列表前缀：▸ 符号标记选中项

## 技术实现细节

### 对话框定位
使用 `centered_rect()` 函数计算居中位置：
- 默认占屏幕 60% 宽度
- 默认占屏幕 50% 高度
- 可根据内容调整

### 状态管理
```rust
// 打开对话框
app.mode = Mode::Dialog;
app.dialog = Some(DialogType::Input { ... });

// 关闭对话框
app.dialog = None;
app.mode = Mode::Normal;
```

### 对话框提交处理
`handle_dialog_submit()` 函数根据对话框标题判断操作类型：
- 包含"创建项目" → 创建新项目
- 包含"选择项目" → 打开项目
- 包含"创建任务" → 创建任务
- 包含"删除" → 删除操作（需确认）

## 待实现功能

1. **任务创建**
   - 连接到文件系统 API
   - 支持设置优先级
   - 支持添加描述

2. **任务编辑**
   - 加载现有任务内容
   - 支持修改标题、描述、优先级

3. **删除确认**
   - 使用 Confirm 对话框
   - 实现实际删除逻辑

4. **项目删除**
   - 添加确认对话框
   - 连接到文件系统 API

## 编译状态

✅ 编译成功（23个警告，0个错误）
✅ Release 构建完成
✅ 所有对话框类型已实现
✅ 键盘输入处理完整

## 测试方法

```bash
# 运行应用
cargo run --release

# 测试快捷键
# 1. Space p n - 创建项目
# 2. Space p o - 打开项目
# 3. Space w v - 垂直分屏
# 4. Space w s - 水平分屏
# 5. j/k/h/l - 导航
# 6. q - 退出
```

## 与参考 UI 对比

根据提供的截图 (SCR-20251209-obuf.png, SCR-20251209-obwm.png)：

✅ 实现了居中弹窗
✅ 实现了项目选择列表
✅ 实现了搜索过滤
✅ 实现了输入对话框
✅ 保持了 Helix 风格的键盘操作
✅ 添加了清晰的帮助提示

## 下一步

1. 实际运行测试验证所有对话框功能
2. 完善任务创建/编辑/删除逻辑
3. 添加更多项目操作（重命名、删除）
4. 改进对话框样式和动画效果
