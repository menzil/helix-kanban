# Kanban TUI 使用指南

## 🎉 已实现功能

### ✅ 项目管理
- **创建项目** - `Space p n`
- **打开项目** - `Space p o`（带搜索过滤）
- **多项目支持** - 可以打开多个项目
- **分屏显示** - 每个面板可以显示不同项目

### ✅ 任务管理
- **创建任务** - `a` 键（在当前选中列创建，自动选中新任务）
- **编辑任务** - `e` 键（修改任务标题）
- **移动任务状态** - `H`/`L` 键（在列之间移动）
- **调整任务顺序** - `J`/`K` 键（在列内上下移动）
- **完整的汉字支持** - 可以输入和编辑中文

### ✅ 界面操作
- **分屏管理**
  - `Space w v` - 垂直分屏
  - `Space w s` - 水平分屏
  - 支持无限层级嵌套
- **面板导航**
  - `h`/`l` 或 `←`/`→` - 切换列
  - `j`/`k` 或 `↑`/`↓` - 选择任务
- **Helix 风格状态栏**
  - 显示当前模式
  - 显示键序列缓冲
  - 显示项目和面板信息
- **帮助系统**
  - `?` 键 - 显示/关闭完整的键盘快捷键帮助面板
  - Helix 风格的三列布局
  - 实时切换，无需退出当前界面

### ✅ 对话框系统
- **输入对话框** - 创建/编辑项目和任务
- **选择对话框** - 选择项目（带搜索）
- **确认对话框** - 危险操作确认（已实现结构）

## 🎮 键盘快捷键速查表

### 基础导航
```
j / ↓       - 下一个任务
k / ↑       - 上一个任务
h / ←       - 上一列（todo ← doing ← done）
l / →       - 下一列（todo → doing → done）
q           - 退出应用
ESC         - 取消/返回正常模式
?           - 显示/关闭键盘快捷键帮助
```

### 任务操作
```
a           - 创建新任务（在当前列）
e           - 编辑选中的任务
d           - 删除任务（待实现）

H (Shift+h) - 将任务移到左边列（改变状态）
L (Shift+l) - 将任务移到右边列（改变状态）
J (Shift+j) - 任务在列内下移
K (Shift+k) - 任务在列内上移
```

### 项目管理
```
Space p o   - 打开项目
Space p n   - 创建新项目
Space p d   - 删除项目（待实现）
Space p r   - 重命名项目（待实现）
```

### 窗口管理
```
Space w v   - 垂直分屏
Space w s   - 水平分屏
Space w c   - 关闭当前面板（待实现）
Space w h   - 聚焦左边面板（待实现）
Space w l   - 聚焦右边面板（待实现）
Space w j   - 聚焦下方面板（待实现）
Space w k   - 聚焦上方面板（待实现）
```

### 对话框内操作
```
输入对话框：
  Enter       - 确认
  ESC         - 取消
  ←/→         - 移动光标
  Home/End    - 跳到开头/结尾
  Backspace   - 删除前一个字符
  Delete      - 删除当前字符

选择对话框：
  j/k 或 ↑/↓  - 上下选择
  输入字符    - 搜索过滤
  Backspace   - 删除搜索字符
  Enter       - 确认选择
  ESC         - 取消
```

## 📋 典型工作流程

### 1. 创建新项目并添加任务
```bash
# 启动应用
cargo run --release

# 步骤：
1. Space p n          # 创建新项目
2. 输入 "我的项目"     # 项目名称
3. Enter             # 确认
4. a                 # 创建任务
5. 输入 "完成设计"     # 任务标题
6. Enter             # 确认
```

### 2. 管理任务生命周期
```
待办 → 进行中 → 已完成

1. 用 j/k 选中任务
2. 按 L 移到 "进行中"
3. 完成后按 L 移到 "已完成"
4. 如需回退按 H
```

### 3. 多项目并行工作
```
1. Space w v         # 垂直分屏
2. Space p o         # 在左边面板打开项目A
3. 选择项目A
4. Space w l         # 切到右边面板（待实现，目前用鼠标）
5. Space p o         # 在右边面板打开项目B
6. 选择项目B
```

### 4. 调整任务优先级
```
1. 在 "待办" 列选中低优先级任务
2. 按 K（Shift+k）上移
3. 按 K 继续上移到列表顶部
4. 高优先级任务现在在顶部
```

## 💾 数据存储

### 文件结构
```
~/.kanban/
└── projects/
    └── 我的项目/
        ├── .kanban.toml    # 项目配置
        ├── todo/
        │   ├── 001.md      # 任务文件
        │   └── 002.md
        ├── doing/
        │   └── 003.md
        └── done/
            └── 004.md
```

### 项目配置文件 (`.kanban.toml`)
```toml
name = "我的项目"
created = "2025-12-09T10:00:00+08:00"

[statuses]
order = ["todo", "doing", "done"]

[statuses.todo]
display = "待办"

[statuses.doing]
display = "进行中"

[statuses.done]
display = "已完成"
```

### 任务文件格式 (`001.md`)
```markdown
# 完成设计

created: 2025-12-09T10:30:00+08:00
priority: high

详细的任务描述内容...
```

## 🐛 已修复的问题

1. ✅ **键盘序列匹配** - 修复了 `Space p o` 等多键序列无法触发的问题
2. ✅ **汉字输入支持** - 修复了输入/删除汉字时崩溃的问题
3. ✅ **光标位置** - 正确处理多字节字符的光标定位
4. ✅ **文件系统集成** - 所有操作都正确保存到文件
5. ✅ **错误回滚** - 文件操作失败时自动恢复状态
6. ✅ **任务移动文件路径** - 修复了任务移动后文件路径未更新的问题
7. ✅ **新任务自动选中** - 创建任务后自动选中并显示新任务

## 🚀 性能特性

- **快速启动** - 编译为 release 版本，启动迅速
- **低资源占用** - 纯文本终端界面，内存占用小
- **文件监控** - 自动检测文件系统变化（待实现）
- **离线优先** - 所有数据本地存储，无需网络

## 🎨 界面特性

- **Nord 配色方案** - 优雅的北欧风格配色
- **Helix 风格** - 熟悉的模态编辑体验
- **响应式布局** - 自适应终端大小
- **清晰的视觉反馈** - 高亮显示选中项

## 📝 待实现功能

### 高优先级
- [ ] 任务删除（`d` 键 + 确认对话框）
- [ ] 面板导航（`Space w h/j/k/l`）
- [ ] 面板关闭（`Space w c`）

### 中优先级
- [ ] 任务详细信息编辑
- [ ] 任务优先级设置
- [ ] 任务截止日期
- [ ] 项目删除和重命名

### 低优先级
- [ ] 任务搜索和过滤
- [ ] 批量操作
- [ ] 撤销/重做
- [ ] 主题配置
- [ ] 导出/导入

## 🔧 技术栈

- **语言**: Rust 2021
- **UI 框架**: ratatui 0.28
- **终端**: crossterm 0.28
- **序列化**: serde + toml
- **时间**: chrono 0.4

## 📚 相关文档

- `DIALOG_SYSTEM.md` - 对话框系统实现
- `KEYBOARD_FIX.md` - 键盘序列修复
- `UNICODE_FIX.md` - 多字节字符支持
- `TASK_OPERATIONS.md` - 任务操作详解
- `CLAUDE.md` - 项目概览

## 💡 提示和技巧

### 快速创建多个任务
```
a → 输入标题 → Enter → a → 输入标题 → Enter ...
```

### 批量移动任务
```
选中任务 → L → 选中下一个 → L → 选中下一个 → L
```

### 快速查看键序列
状态栏会显示你正在输入的键序列，如 `[ p]` 表示已按下 Space 和 p

### 汉字输入技巧
- 输入时光标会实时显示位置
- 可以使用方向键移动光标到任意位置
- Backspace 和 Delete 都能正确删除汉字

## 🎯 快速开始

```bash
# 1. 构建应用
cargo build --release

# 2. 运行应用
cargo run --release

# 3. 创建第一个项目
Space p n → 输入项目名 → Enter

# 4. 创建第一个任务
a → 输入任务标题 → Enter

# 5. 移动任务状态
选中任务 → L（移到进行中）→ L（移到已完成）

# 6. 退出应用
q
```

## 📧 反馈

遇到问题或有建议？欢迎提交 Issue！

---

**享受高效的任务管理体验！** 🚀
